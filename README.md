# å¾®åšæ‰«ç ç™»å½• Cookies è·å–å·¥å…·

ä¸€ä¸ªåŸºäº Tauri çš„æ¡Œé¢åº”ç”¨,ç”¨äºé€šè¿‡æ‰«ç ç™»å½•è·å–å¾®åš Cookies å¹¶ä¿å­˜åˆ° Redisã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… å¾®åšæ‰«ç ç™»å½• (WebSocket å®æ—¶æ¨é€)
- âœ… Cookies è‡ªåŠ¨éªŒè¯ (é€šè¿‡ Playwright è°ƒç”¨å¾®åš VIP API)
- âœ… Redis æŒä¹…åŒ–å­˜å‚¨ (30å¤©è¿‡æœŸ)
- âœ… å¤šè´¦æˆ·ç®¡ç† (æ”¯æŒä¿å­˜å¤šä¸ªå¾®åšè´¦æˆ·)
- âœ… ç»“æ„åŒ–æ—¥å¿— (JSON æ ¼å¼,æŒ‰å¤©è½®è½¬)
- âœ… å“åº”å¼ UI (æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯)
- âœ… **WebSocket æ–­çº¿é‡è¿** (è‡ªåŠ¨é‡è¯• 5 æ¬¡,æŒ‡æ•°é€€é¿)
- âœ… **å¢å¼ºè°ƒè¯•æ—¥å¿—** (è¯¦ç»†çš„ç½‘ç»œè¯·æ±‚è¿½è¸ª)

## æŠ€æœ¯æ ˆ

### åç«¯
- **Tauri 1.5** - è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
- **Rust 1.75+** - ç³»ç»Ÿç¼–ç¨‹è¯­è¨€
- **Tokio** - å¼‚æ­¥è¿è¡Œæ—¶
- **Redis** - æ•°æ®å­˜å‚¨
- **Playwright (Node.js)** - Cookies éªŒè¯

### å‰ç«¯
- **React 18** - UI æ¡†æ¶
- **TypeScript 5** - ç±»å‹å®‰å…¨
- **TailwindCSS 3** - æ ·å¼æ¡†æ¶
- **Vite** - æ„å»ºå·¥å…·

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ„å»º Rust åç«¯
cd src-tauri && cargo build --release && cd ..

# æ„å»º Playwright æœåŠ¡å™¨
cd playwright && pnpm install && pnpm run build && cd ..
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:
```env
REDIS_URL=redis://localhost:6379
WEIBO_APP_KEY=your_app_key
PLAYWRIGHT_SCRIPT_PATH=./playwright/dist/validate-cookies.js
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ Redis (ä½¿ç”¨ Docker Compose)
docker compose up redis -d

# å¯åŠ¨ Playwright WebSocket æœåŠ¡å™¨
cd playwright && node dist/weibo-login-server.js &

# æˆ–è€…ä½¿ç”¨ pnpm è„šæœ¬
pnpm --filter playwright server &
```

### 4. è¿è¡Œåº”ç”¨

```bash
# å¼€å‘æ¨¡å¼ (è‡ªåŠ¨çƒ­é‡è½½)
pnpm tauri dev

# æˆ–åˆ†åˆ«å¯åŠ¨å‰ç«¯å’Œåç«¯
pnpm dev  # å‰ç«¯ Vite æœåŠ¡å™¨
cargo tauri dev  # åç«¯ Rust åº”ç”¨
```

## ä½¿ç”¨æµç¨‹

1. **ç”ŸæˆäºŒç»´ç **: ç‚¹å‡»"ç”ŸæˆäºŒç»´ç "æŒ‰é’®
2. **æ‰«ç ç™»å½•**: ä½¿ç”¨å¾®åš App æ‰«æäºŒç»´ç 
3. **ç¡®è®¤ç™»å½•**: åœ¨æ‰‹æœºä¸Šç‚¹å‡»"ç¡®è®¤ç™»å½•"
4. **è‡ªåŠ¨ä¿å­˜**: Cookies è‡ªåŠ¨éªŒè¯å¹¶ä¿å­˜åˆ° Redis

## é¡¹ç›®ç»“æ„

```
desktop/
â”œâ”€â”€ src/                    # Reactå‰ç«¯
â”‚   â”œâ”€â”€ components/         # UIç»„ä»¶
â”‚   â”œâ”€â”€ pages/              # é¡µé¢
â”‚   â””â”€â”€ types/              # TypeScriptç±»å‹
â”œâ”€â”€ src-tauri/              # Ruståç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ commands/       # Tauriå‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ playwright/             # PlaywrightéªŒè¯è„šæœ¬
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ validate-cookies.ts
â””â”€â”€ specs/                  # è®¾è®¡æ–‡æ¡£
    â””â”€â”€ 001-cookies/
        â”œâ”€â”€ spec.md         # åŠŸèƒ½è§„æ ¼
        â”œâ”€â”€ plan.md         # å®æ–½è®¡åˆ’
        â””â”€â”€ contracts/      # APIå¥‘çº¦
```

## æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](./QUICKSTART.md) - å¼€å‘ç¯å¢ƒæ­å»ºå’Œæµ‹è¯•åœºæ™¯
- [APIæ–‡æ¡£](./API.md) - Tauriå‘½ä»¤æ¥å£è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [è®¾è®¡æ–‡æ¡£](./specs/001-cookies/spec.md) - åŠŸèƒ½è§„æ ¼å’ŒæŠ€æœ¯æ–¹æ¡ˆ

## å¼€å‘æŒ‡å—

### æ„å»º

```bash
# å¼€å‘æ¨¡å¼
pnpm tauri dev

# ç”Ÿäº§æ„å»º
pnpm tauri build
```

### æµ‹è¯•

```bash
# Rustå•å…ƒæµ‹è¯•
cd src-tauri && cargo test

# Playwrightè„šæœ¬æµ‹è¯•
cd playwright && ./test-validate.sh
```

### æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä½ç½®: `logs/weibo-login.log`

```bash
# å®æ—¶æŸ¥çœ‹
tail -f logs/weibo-login.log

# æŸ¥çœ‹é”™è¯¯
grep ERROR logs/weibo-login.log
```

## æ¶æ„è®¾è®¡

### WebSocket å®æ—¶æ¨é€æ¶æ„

æœ¬é¡¹ç›®ä½¿ç”¨ **WebSocket** æ›¿ä»£ä¼ ç»Ÿè½®è¯¢,å®ç°çœŸæ­£çš„å®æ—¶çŠ¶æ€æ¨é€:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         WebSocket         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tauri åç«¯     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Playwright æœåŠ¡å™¨     â”‚
â”‚  (Rust)         â”‚                           â”‚  (Node.js)           â”‚
â”‚                 â”‚                           â”‚                      â”‚
â”‚  - ç”ŸæˆäºŒç»´ç     â”‚   qrcode_generated       â”‚  - ç›‘å¬å¾®åšç™»å½•é¡µ     â”‚
â”‚  - ç›‘æ§ç™»å½•çŠ¶æ€  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  - æ•è·çŠ¶æ€å˜åŒ–      â”‚
â”‚  - ä¿å­˜ Cookies â”‚                           â”‚  - VIP API éªŒè¯      â”‚
â”‚                 â”‚   status_update          â”‚                      â”‚
â”‚                 â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                      â”‚
â”‚                 â”‚   login_confirmed        â”‚                      â”‚
â”‚                 â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹æ€§**:
- âœ… **æ–­çº¿é‡è¿**: è‡ªåŠ¨æ£€æµ‹æ–­å¼€,æœ€å¤šé‡è¯• 5 æ¬¡ (æŒ‡æ•°é€€é¿: 2â†’4â†’8â†’16â†’30ç§’)
- âœ… **çŠ¶æ€é€šçŸ¥**: å‘é€ `websocket_connection_lost` å’Œ `websocket_connection_restored` äº‹ä»¶
- âœ… **ä¼šè¯ä¿æŒ**: é‡è¿åä¿æŒåŸæœ‰ `qr_id`,æ— éœ€é‡æ–°æ‰«ç 
- âœ… **å¢å¼ºæ—¥å¿—**: è¯¦ç»†çš„ç½‘ç»œè¯·æ±‚è¿½è¸ª (ğŸŒè¯·æ±‚ ğŸ“¥å“åº” âœ…æ•è· ğŸ“Šæ•°æ® ğŸ“¤å‘é€ ğŸ’“å¿ƒè·³)

### ä»£ç è‰ºæœ¯å®¶å®ªç« 

æœ¬é¡¹ç›®éµå¾ª **ä»£ç è‰ºæœ¯å®¶å®ªç« ** (`.specify/memory/constitution.md`),ä½“ç°äº”å¤§æ ¸å¿ƒåŸåˆ™:

1. **å­˜åœ¨å³åˆç†** - æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸å¯æ›¿ä»£çš„å­˜åœ¨ç†ç”±
2. **ä¼˜é›…å³ç®€çº¦** - ä»£ç è‡ªæˆ‘é˜è¿°,æ— å†—ä½™æ³¨é‡Š
3. **æ€§èƒ½å³è‰ºæœ¯** - å¼‚æ­¥æ“ä½œ,è¿æ¥æ± ,ä¼˜åŒ–æ„å»º
4. **é”™è¯¯å¤„ç†å“²å­¦** - ç»“æ„åŒ–é”™è¯¯,ç”¨æˆ·å‹å¥½æç¤º
5. **æ—¥å¿—è¡¨è¾¾æ€æƒ³** - ç»“æ„åŒ–æ—¥å¿—,è®²è¿°ç³»ç»Ÿæ•…äº‹

## æ€§èƒ½æŒ‡æ ‡

- äºŒç»´ç ç”Ÿæˆ: < 500ms
- WebSocket å»¶è¿Ÿ: < 100ms (å®æ—¶æ¨é€)
- CookieséªŒè¯: < 2s (VIP API)
- Redisæ“ä½œ: < 100ms
- é‡è¿æ—¶é—´: 2-30s (æŒ‡æ•°é€€é¿)

## æ•…éšœæ’é™¤

### Playwright æœåŠ¡å™¨æœªå¯åŠ¨

**ç—‡çŠ¶**: å‰ç«¯æ˜¾ç¤º "PlaywrightæœåŠ¡å™¨æœªè¿è¡Œ"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
curl http://localhost:9223

# 2. å¯åŠ¨ Playwright æœåŠ¡å™¨
cd playwright && node dist/weibo-login-server.js

# 3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f playwright/logs/server.log
```

### WebSocket è¿æ¥æ–­å¼€

**ç—‡çŠ¶**: æ‰«ç åå‰ç«¯æ— ååº”,åç«¯æ—¥å¿—æ˜¾ç¤º "WebSocketè¿æ¥æ–­å¼€"

**è§£å†³æ–¹æ¡ˆ**:
- âœ… **è‡ªåŠ¨é‡è¿**: ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•é‡è¿ (æœ€å¤š 5 æ¬¡)
- âœ… **ç”¨æˆ·æç¤º**: å‰ç«¯æ˜¾ç¤º "è¿æ¥æ–­å¼€,æ­£åœ¨è‡ªåŠ¨é‡è¿..."
- âŒ **é‡è¿å¤±è´¥**: å¦‚æœé‡è¿å¤±è´¥,ç‚¹å‡»"åˆ·æ–°äºŒç»´ç "é‡æ–°å¼€å§‹

**æ‰‹åŠ¨å¹²é¢„** (ä»…å¼€å‘ç¯å¢ƒ):
```bash
# é‡å¯ Playwright æœåŠ¡å™¨
pkill -f "weibo-login-server"
cd playwright && node dist/weibo-login-server.js &

# Tauri åº”ç”¨ä¼šè‡ªåŠ¨é‡è¿,æ— éœ€é‡å¯
```

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# Playwright æœåŠ¡å™¨æ—¥å¿— (å¢å¼ºçš„è°ƒè¯•è¾“å‡º)
# åŒ…å«: ğŸŒè¯·æ±‚ ğŸ“¥å“åº” âœ…æ•è· ğŸ“Šæ•°æ® ğŸ“¤å‘é€ ğŸ’“å¿ƒè·³
tail -f playwright/logs/server.log

# Tauri åç«¯æ—¥å¿—
tail -f logs/weibo-login.log

# è¿‡æ»¤é‡è¿ç›¸å…³æ—¥å¿—
grep -E "é‡è¿|reconnect" logs/weibo-login.log
```

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

ğŸ¨ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
